# å¤šçº¿ç¨‹

ä¸€ã€è¿›ç¨‹

- ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼ŒæŒ‡ä»¤è¦è¿è¡Œï¼Œéœ€è¦å°†æŒ‡ä»¤åŠ è½½åˆ°CPUä¸­ï¼Œæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æŸ±æ•°æ®è¦è¯»å†™ï¼ŒæŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¿é—®ç£ç›˜æ–‡ä»¶ã€ç½‘ç»œè®¾å¤‡ç­‰ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç†IOæ“ä½œã€‚
- è¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºï¼Œå¯ä»¥ç”³è¯·å’Œä½¿ç”¨ç³»ç»Ÿèµ„æºï¼Œæ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µï¼Œå½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºä»£ç è‡³å†…å­˜ä¸­ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥è¯´å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚
- è¿›ç¨‹å¯ä»¥è§†ä½œç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚æœ‰ä¸€äº›ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼Œæ¯”å¦‚:è®°äº‹æœ¬ã€æµè§ˆå™¨ã€ç”»å›¾ï¼Œæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼Œæ¯”å¦‚:ç”µè„‘ç®¡å®¶ã€360å®‰å…¨å«å£«ç­‰ã€‚

äºŒã€çº¿ç¨‹

- ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ï¼›
- ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤æŒ‰ç…§ä¸€å®šçš„é¡ºåº(é¡ºåºæ‰§è¡Œã€é€‰æ‹©æ‰§è¡Œã€å¾ªç¯æ‰§è¡Œ)ï¼Œäº¤ç»™CPUæ‰§è¡Œï¼›
- javaä¸­ï¼Œçº¿ç¨‹æ˜¯ä½œä¸ºæœ€å°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼›
- åœ¨windowsç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œä¸ºçº¿ç¨‹çš„å®¹å™¨ï¼›

ä¸‰ã€åŒºåˆ«

> - è¿›ç¨‹æ˜¯è´Ÿè´£åŠ è½½ç®¡ç†èµ„æºçš„ï¼Œçº¿ç¨‹æ˜¯è´Ÿè´£æ‰§è¡ŒæŒ‡ä»¤çš„ã€‚
> - è¿›ç¨‹åŸºæœ¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸€ä¸ªå­é›†ã€‚
> - è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å†…éƒ¨çš„çº¿ç¨‹å…±äº«ã€‚
> - è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚
>   - åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡IPC(Inter-process communication)
>   - ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶ä¸”éµå¾ªå…±åŒçš„åè®®
> - çº¿ç¨‹é€šä¿¡æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºçº¿ç¨‹å…·æœ‰å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œå¯ä»¥å®ç°ä»»åŠ¡è°ƒåº¦
> - çº¿ç¨‹æ›´è½»é‡çº§ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬è¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä½è¿›ç¨‹æ˜¯è´Ÿè´£åŠ è½½ç®¡ç†èµ„æºçš„ï¼Œçº¿ç¨‹æ˜¯è´Ÿè´£æ‰§è¡ŒæŒ‡ä»¤çš„ã€‚

å››ã€å¹¶è¡Œå’Œå¹¶å‘

- å¹¶å‘: åœ¨å•æ ¸CPUä¸‹ï¼Œçº¿ç¨‹å®é™…æ˜¯ä»¥ä¸²è¡Œçš„æ–¹å¼æ‰§è¡Œæ“ä½œç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨ç»„ä»¶ï¼Œå°†cpuçš„æ—¶é—´ç‰‡åˆ†ç»™ä¸åŒçš„ç¨‹åºä½¿ç”¨ã€‚ç”±äºcpuæ—¶é—´ç‰‡å¾ˆçŸ­ï¼Œåˆ‡æ¢é€Ÿåº¦éå¸¸å¿«ï¼Œä½¿ç”¨æˆ·çœ‹èµ·æ¥ï¼Œå¤šä¸ªä»»åŠ¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼›
- å¹¶è¡Œ: åœ¨å¤šæ ¸CPUä¸‹ï¼Œæ¯ä¸ªæ ¸éƒ½å¯ä»¥å®Œæˆçº¿ç¨‹çš„æ‰§è¡Œï¼›

# JUC

## ä¸€ã€çº¿ç¨‹çš„åˆ›å»ºå’Œè¿è¡Œ

### 1. æ–¹æ³•ä¸€: ç»§æ‰¿Threadç±»ï¼Œé‡å†™ run æ–¹æ³•

![image.png](assets/image2.png)

> Threadç±», å®ç°äº†Runnableæ¥å£ï¼Œè°ƒç”¨æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹çš„ start() æ–¹æ³•ï¼Œè‡ªåŠ¨æ‰§è¡Œ run() æ–¹æ³•;

```java
public class TestThread {
    public static void main(String[] args) {
        System.out.println("ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ");
        MyThread myThread01 = new MyThread();
        Thread myThread02 = new Thread(()->{ // ä¹Ÿå¯ä»¥ç”¨ åŒ¿åå†…éƒ¨ç±» / lambda è¡¨è¾¾å¼çš„åˆ›å»ºçº¿ç¨‹
            System.out.println("å­çº¿ç¨‹" + Thread.currentThread().getName() +"æ‰§è¡Œ");
        });
        MyThread myThread03 = new MyThread();
        myThread01.setName("01");
        myThread02.setName("02");
        myThread03.setName("03");
        myThread01.start(); // å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹ï¼Œè‡ªåŠ¨è°ƒç”¨runæ–¹æ³•
        myThread02.start();
        myThread03.start();
        System.out.println("ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸ");

        new Thread(()->{
            System.out.println("lambda åˆ›å»ºçš„çº¿ç¨‹");
        }).start();
    }
}

class MyThread extends Thread {
    @Override
    public void run() {
        System.out.println("å­çº¿ç¨‹" + Thread.currentThread().getName() +"æ‰§è¡Œ");
    }
}
```

### 2. æ–¹å¼äºŒ: å®ç° Runnable æ¥å£ï¼Œé‡å†™ run æ–¹æ³•ï¼Œé…åˆ Thread

> ä¹Ÿå¯ä»¥ç”¨ ã€åŒ¿åå†…éƒ¨ç±» / lambda è¡¨è¾¾å¼ã€‘çš„åˆ›å»ºçº¿ç¨‹ï¼›å› ä¸º Thread çš„æ„é€ æ–¹æ³•å¯ä»¥ä¼ å…¥ä¸€ä¸ª Runnable æ¥å£çš„å®ç°ç±»ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ã€åŒ¿åå†…éƒ¨ç±» / lambda è¡¨è¾¾å¼ã€‘ä»£æ›¿ Runnable æ¥å£çš„å®ç°ç±»ï¼›

- æ›´æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œæ–¹æ³•ä¸€æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆå¹¶åœ¨ä¸€èµ·ï¼Œæ–¹æ³•äºŒæŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€ã€‚â¤ï¸
- ä½¿ç”¨ Runnable æ›´å®¹æ˜“å’Œçº¿ç¨‹æ± é«˜çº§APIé…åˆï¼Œå¹¶ä¸”è®©ç±»è„±ç¦»äº†Threadç»§æ‰¿ä½“ç³»ã€‚

```java
public class TestRunnable {
    public static void main(String[] args) {
        System.out.println("ä¸»çº¿ç¨‹å¼€å§‹");
        MyRunnableImpl myRunnable = new MyRunnableImpl();
//        myRunnable.run(); // ç›´æ¥è°ƒç”¨ run() æ–¹æ³•ä¸ä¼šå¼€è¾Ÿå­çº¿ç¨‹
        Thread thread = new Thread(myRunnable);
        thread.start(); // Runnable å®ç°ç±»ï¼Œéœ€è¦å€ŸåŠ© Thread å¦å¤–å¼€å¯å­çº¿ç¨‹
        Thread thread1 = new Thread(()->{
            System.out.println("å­çº¿ç¨‹" + Thread.currentThread().getName() +"æ‰§è¡Œ");
        });
        thread1.start();
        new Thread(()->System.out.println("å­çº¿ç¨‹" + Thread.currentThread().getName() +"æ‰§è¡Œ"), "hello").start(); // ç¬¬äºŒä¸ªå‚æ•°æ˜¯çº¿ç¨‹çš„åå­—
        System.out.println("ä¸»çº¿ç¨‹ç»“æŸ");
    }
}
class MyRunnableImpl implements Runnable{

    @Override
    public void run() {
        System.out.println("å­çº¿ç¨‹" + Thread.currentThread().getName() +"æ‰§è¡Œ");
    }
}
```

### 3. æ–¹å¼ä¸‰ï¼šFutureTask é…åˆ Thread å’Œ Callable

![image.png](assets/image1.png)

> FutureTask å®ç°äº† Futureçš„å­ç±»æ¥å£ï¼Œæ˜¯ JDK1.5 å¼•å…¥çš„ä¸€ä¸ªæ¥å£ï¼Œç”¨äºå¼‚æ­¥è·å–ç»“æœï¼›è¡¨ç¤ºä¸€ä¸ªå¯èƒ½è¿˜æ²¡æœ‰å®Œæˆçš„å¼‚æ­¥ä»»åŠ¡çš„ç»“æœï¼Œé’ˆå¯¹è¿™ä¸ªç»“æœï¼Œå¯ä»¥æ·»åŠ å›è°ƒå¤„ç†ï¼Œä»¥ä¾¿åœ¨ä»»åŠ¡æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥åä½œå‡ºç›¸åº”çš„æ“ä½œ.

ä½¿ç”¨åœºæ™¯ï¼šæ‰§è¡Œä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œä½¿ç”¨ Future å»æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶å»å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚ç­‰å¾…é•¿ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼Œå†åšè®¡ç®—å¤„ç†ã€‚

- è®¡ç®—å¯†é›†åœºæ™¯
- å¤„ç†å¤§æ•°æ®é‡
- è¿œç¨‹æ–¹æ³•è°ƒç”¨

æ¥å£ä¸­ä½¿ç”¨åˆ°çš„æ–¹æ³•ï¼š

- boolean cancel(boolean): å–æ¶ˆä»»åŠ¡ï¼›
- boolean isCancelled(): åˆ¤æ–­ä»»åŠ¡åœ¨å®Œæˆä¹‹å‰ï¼Œæ˜¯å¦å–æ¶ˆï¼›
- boolean isDone(): ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚æ­£å¸¸ç»ˆæ­¢ã€å¼‚å¸¸æˆ–å–æ¶ˆï¼Œéƒ½è®¤ä¸ºæ˜¯ä»»åŠ¡å®Œæˆï¼›
- V get(): è·å–è®¡ç®—ç»“æœï¼›
- V get(long timeout,Timeunit unit): è·å–è®¡ç®—ç»“æœï¼Œè¶…æ—¶æ—¶é—´ï¼›

â¤ï¸ Callable æ¥å£å’Œ Runnable æ¥å£åŒºåˆ«:â¤ï¸

- Callable çš„ call æ–¹æ³•å…·æœ‰è¿”å›å€¼, Runnalbe çš„ run æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼›
- Runnable æ–¹æ³•æ˜¯ run æ–¹æ³•ä½œä¸ºçº¿ç¨‹è¿è¡Œä»»åŠ¡çš„å…¥å£ï¼ŒCallableæ¥å£æ–¹æ³•æ˜¯ call æ–¹æ³•;
- call æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œrunæ–¹æ³•ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œå®ç°callableæ¥å£ï¼Œå¯ä»¥å¯¹çº¿ç¨‹è¿è¡Œä»»åŠ¡çš„å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œä»è€Œå¾—çŸ¥å¼‚å¸¸çš„åŸå› ;
- Callable é…åˆ Future å¯¹è±¡ï¼Œè·å–å¼‚æ­¥è®¡ç®—çš„ç»“æœï¼›
- Callable æ˜¯ä¾›ç»™å‹å‡½æ•°å¼æ¥å£ï¼›

> FutureTask æ„é€ æ—¶ä¼ å…¥ Callable æ¥å£çš„å®ç°ç±»ï¼Œè¦æ±‚å®ç° call æ–¹æ³•ï¼Œæœ‰è¿”å›å€¼

```java
public class TestFuture {
    public static void main(String[] args) throws ExecutionException, InterruptedException, TimeoutException {
//        FutureTask<Integer> futureTask = new FutureTask<>(new Callable<Integer>() {
//            @Override
//            public Integer call() throws Exception {
//                int sum = 0, i=1;
//                while (i<=100){
//                    sum+=i;
//                    i++;
//                }
//                return sum;
//            }
//        });
        FutureTask<Integer> futureTask = new FutureTask<>(() -> {
            int sum = 0, i=1;
            while (i<=100){
                sum+=i;
                i++;
            }
            Thread.sleep(3000);
            return sum;
        });
        new Thread(futureTask).start();
//        Thread.sleep(2000);
//        futureTask.cancel(true);
        System.out.println(futureTask.isCancelled());
        System.out.println(futureTask.isDone());
        System.out.println(futureTask.get(20000, TimeUnit.MILLISECONDS));
    }
}
```

## äºŒã€æŸ¥çœ‹è¿›ç¨‹å’Œçº¿ç¨‹çš„æ–¹æ³•

> - windows: ã€tasklistã€‘ å‘½ä»¤æŸ¥çœ‹è¿›ç¨‹ ã€tasklist /ï¼Ÿ æŸ¥çœ‹å¸®åŠ©ã€‘
> - windowsï¼šã€taskkill /F /PID è¿›ç¨‹pidå·ã€‘ æ€æ­»è¿›ç¨‹
> - ã€jpsã€‘: æŸ¥çœ‹æ‰€æœ‰javaçš„è¿›ç¨‹ ğŸ‘
> - ã€jstack PIDã€‘: æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œç”Ÿæˆjvmå½“å‰æ—¶åˆ»æ‰€æœ‰çº¿ç¨‹å¿«ç…§ã€‚ğŸ‘
> - ã€jconsoleã€‘: ä»¥å›¾å½¢ç•Œé¢æ–¹å¼æŸ¥çœ‹javaè¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ ğŸ‘

```bash
PS D:\MyProject\Java\JavaLearning> taskkill /F /PID 19872
æˆåŠŸ: å·²ç»ˆæ­¢ PID ä¸º 19872 çš„è¿›ç¨‹ã€‚
```

![image.png](assets/image3.png)

```bash
PS D:\MyProject\Java\JavaLearning> jstack 19872
2024-06-28 21:28:33
Full thread dump OpenJDK 64-Bit Server VM (11.0.18+10-LTS mixed mode):

Threads class SMR info:
_java_thread_list=0x0000012d7d9889e0, length=12, elements={
0x0000012d7cd1d800, 0x0000012d7d5c3000, 0x0000012d7d630000, 0x0000012d7d631000,
0x0000012d7d634000, 0x0000012d7d635800, 0x0000012d7d636800, 0x0000012d7d638000,
0x0000012d7d5a0800, 0x0000012d7d92a000, 0x0000012d7d92e000, 0x0000012d5866f000
}

"Reference Handler" #2 daemon prio=10 os_prio=2 cpu=0.00ms elapsed=237.41s tid=0x0000012d7cd1d800 nid=0x84f0 waiting on condition  [0x0000000ddf6ff000]
   java.lang.Thread.State: RUNNABLE
        at java.lang.ref.Reference.waitForReferencePendingList(java.base@11.0.18/Native Method)
        at java.lang.ref.Reference.processPendingReferences(java.base@11.0.18/Reference.java:241)
        at java.lang.ref.Reference$ReferenceHandler.run(java.base@11.0.18/Reference.java:213)

"Finalizer" #3 daemon prio=8 os_prio=1 cpu=0.00ms elapsed=237.41s tid=0x0000012d7d5c3000 nid=0x5624 in Object.wait()  [0x0000000ddf7ff000]
   java.lang.Thread.State: WAITING (on object monitor)
        at java.lang.Object.wait(java.base@11.0.18/Native Method)
        - waiting on <0x0000000714308f98> (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(java.base@11.0.18/ReferenceQueue.java:155)
        - waiting to re-lock in wait() <0x0000000714308f98> (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(java.base@11.0.18/ReferenceQueue.java:176)
        at java.lang.ref.Finalizer$FinalizerThread.run(java.base@11.0.18/Finalizer.java:170)

"Signal Dispatcher" #4 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d630000 nid=0x801c runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Attach Listener" #5 daemon prio=5 os_prio=2 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d631000 nid=0x6b5c waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Service Thread" #6 daemon prio=9 os_prio=0 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d634000 nid=0x74d0 runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" #7 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d635800 nid=0x81f0 waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
   No compile task

"C1 CompilerThread0" #15 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d636800 nid=0x7e9c waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE
   No compile task

"Sweeper thread" #19 daemon prio=9 os_prio=2 cpu=0.00ms elapsed=237.40s tid=0x0000012d7d638000 nid=0x73f8 runnable  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"Common-Cleaner" #20 daemon prio=8 os_prio=1 cpu=0.00ms elapsed=237.35s tid=0x0000012d7d5a0800 nid=0x8478 in Object.wait()  [0x0000000ddfeff000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
        at java.lang.Object.wait(java.base@11.0.18/Native Method)
        - waiting on <0x0000000714231900> (a java.lang.ref.ReferenceQueue$Lock)
        at java.lang.ref.ReferenceQueue.remove(java.base@11.0.18/ReferenceQueue.java:155)
        - waiting to re-lock in wait() <0x0000000714231900> (a java.lang.ref.ReferenceQueue$Lock)
        at jdk.internal.ref.CleanerImpl.run(java.base@11.0.18/CleanerImpl.java:148)
        at java.lang.Thread.run(java.base@11.0.18/Thread.java:829)
        at jdk.internal.misc.InnocuousThread.run(java.base@11.0.18/InnocuousThread.java:161)

"Monitor Ctrl-Break" #21 daemon prio=5 os_prio=0 cpu=15.63ms elapsed=237.31s tid=0x0000012d7d92a000 nid=0x7510 runnable  [0x0000000de03fe000]
   java.lang.Thread.State: RUNNABLE
        at java.net.SocketInputStream.socketRead0(java.base@11.0.18/Native Method)
        at java.net.SocketInputStream.socketRead(java.base@11.0.18/SocketInputStream.java:115)
        at java.net.SocketInputStream.read(java.base@11.0.18/SocketInputStream.java:168)
        at java.net.SocketInputStream.read(java.base@11.0.18/SocketInputStream.java:140)
        at sun.nio.cs.StreamDecoder.readBytes(java.base@11.0.18/StreamDecoder.java:284)
        at sun.nio.cs.StreamDecoder.implRead(java.base@11.0.18/StreamDecoder.java:326)
        at sun.nio.cs.StreamDecoder.read(java.base@11.0.18/StreamDecoder.java:178)
        - locked <0x00000007140061b8> (a java.io.InputStreamReader)
        at java.io.InputStreamReader.read(java.base@11.0.18/InputStreamReader.java:181)
        at java.io.BufferedReader.fill(java.base@11.0.18/BufferedReader.java:161)
        at java.io.BufferedReader.readLine(java.base@11.0.18/BufferedReader.java:326)
        - locked <0x00000007140061b8> (a java.io.InputStreamReader)
        at java.io.BufferedReader.readLine(java.base@11.0.18/BufferedReader.java:392)
        at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:56)

"çº¿ç¨‹1" #22 prio=5 os_prio=0 cpu=53343.75ms elapsed=237.31s tid=0x0000012d7d92e000 nid=0x5148 runnable  [0x0000000de05fe000]
   java.lang.Thread.State: RUNNABLE
        at com.slz.javalearing.day17.TestPID.lambda$main$0(TestPID.java:13)
        at com.slz.javalearing.day17.TestPID$$Lambda$14/0x0000000800066840.run(Unknown Source)
        at java.lang.Thread.run(java.base@11.0.18/Thread.java:829)

"DestroyJavaVM" #23 prio=5 os_prio=0 cpu=62.50ms elapsed=237.31s tid=0x0000012d5866f000 nid=0x7cb0 waiting on condition  [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"VM Thread" os_prio=2 cpu=0.00ms elapsed=237.41s tid=0x0000012d7cd19800 nid=0x1974 runnable

"GC Thread#0" os_prio=2 cpu=0.00ms elapsed=237.43s tid=0x0000012d58689800 nid=0x76c0 runnable

"G1 Main Marker" os_prio=2 cpu=0.00ms elapsed=237.43s tid=0x0000012d586e7800 nid=0x5234 runnable

"G1 Conc#0" os_prio=2 cpu=0.00ms elapsed=237.43s tid=0x0000012d586e9000 nid=0x6bbc runnable

"G1 Refine#0" os_prio=2 cpu=0.00ms elapsed=237.42s tid=0x0000012d7cc01800 nid=0x6f58 runnable

"G1 Young RemSet Sampling" os_prio=2 cpu=0.00ms elapsed=237.42s tid=0x0000012d7cc04800 nid=0x5650 runnable
"VM Periodic Task Thread" os_prio=2 cpu=0.00ms elapsed=237.31s tid=0x0000012d7d92b000 nid=0x1910 waiting on condition

JNI global refs: 24, weak refs: 0

```

![image.png](assets/image4.png)

![image.png](assets/image5.png)

## ä¸‰ã€çº¿ç¨‹çš„çŠ¶æ€

### 1. æ“ä½œç³»ç»Ÿå±‚é¢åˆ’åˆ†: äº”ç§çŠ¶æ€

- ã€åˆå§‹çŠ¶æ€ã€‘ï¼šåœ¨ç¼–ç¨‹è¯­è¨€å±‚é¢ä¸Šåˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æ²¡æœ‰ä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼›
- ã€å¯è¿è¡ŒçŠ¶æ€ã€‘:å½“å‰çº¿ç¨‹å·²ç»ä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼Œå¯ä»¥ç”±CPUè°ƒåº¦æ‰§è¡Œï¼›
- ã€è¿è¡ŒçŠ¶æ€ã€‘:
  - è·å–äº†CPUæ—¶é—´ç‰‡ï¼Œåœ¨è¿è¡Œä¸­çš„çŠ¶æ€ï¼›
  - å½“cpuæ—¶é—´ç‰‡ç”¨å®Œåï¼Œä¼šä»è¿è¡ŒçŠ¶æ€åˆ‡æ¢å›å¯è¿è¡ŒçŠ¶æ€ï¼Œå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼›
- ã€é˜»å¡çŠ¶æ€ã€‘ï¼š
  - å¦‚æœè°ƒç”¨äº†é˜»å¡çš„APIåº”ç”¨ï¼Œä¾‹å¦‚BIOè¯»å†™æ–‡ä»¶ã€‚ä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼›
  - å½“BIOæ“ä½œå®Œæˆä¹‹åï¼Œç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œåˆ‡æ¢åˆ°å¯è¿è¡ŒçŠ¶æ€ï¼›
  - å¯¹äºé˜»å¡çº¿ç¨‹æ¥è®²ï¼Œåªè¦ä¸è¢«å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬æ‰§è¡Œï¼›
- ã€ç»ˆæ­¢çŠ¶æ€ã€‘ï¼šè¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œç»“æŸï¼Œç”Ÿå‘½å‘¨æœŸå…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€ï¼›

![image.png](assets/image6.png)

### 2. ç¼–ç¨‹è¨€å±‚é¢åˆ’åˆ†ï¼šå…­ç§çŠ¶æ€

![image.png](assets/image7.png)

â¤ï¸ æ ¹æ® JavaAPI ä¸­ Thread ç±»ä¸‹çš„ State æšä¸¾ç±»å‹ï¼Œåˆ†ä¸ºä»¥ä¸‹å…­ç§çŠ¶æ€ï¼šâ¤ï¸

- ã€NEWã€‘: è¡¨ç¤ºçº¿ç¨‹åˆšåˆšåˆ›å»ºå¯¹è±¡ï¼Œè¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•ï¼›
- ã€RUNNABLEã€‘: è°ƒç”¨äº† start() æ–¹æ³•ï¼Œjava çš„ RUNNABLE çŠ¶æ€ï¼ŒåŒ…æ‹¬äº†æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå¯è¿è¡ŒçŠ¶æ€ã€è¿è¡ŒçŠ¶æ€å’Œé˜»å¡çŠ¶æ€(BIOå¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨javaç¨‹åºä¸­æ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸ºæ˜¯å¯è¿è¡ŒçŠ¶æ€)ï¼›
- ã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€‘: éƒ½æ˜¯åœ¨ Java å±‚é¢ï¼Œå¯¹é˜»å¡çŠ¶æ€çš„ç»†åˆ†æƒ…å†µï¼›
- ã€TERMINATEDã€‘: å½“å‰çº¿ç¨‹æ‰§è¡Œç»“æŸï¼›

![image.png](assets/image8.png)

### 3. ä»£ç æ¼”ç¤ºçº¿ç¨‹è¿è¡ŒçŠ¶æ€

- NEWã€RUNNABLEã€TERMINATED

```JAVA
public class TestThreadState {
    public static void main(String[] args) throws InterruptedException {
        System.out.println("ä¸»çº¿ç¨‹å¼€å§‹");
        Thread t1 = new Thread(()->{
            try {
                FileReader fileReader = new FileReader("javabase/resource/data.txt");
                BufferedReader bufferedReader = new BufferedReader(fileReader);
                String s;
                Integer flag = 0;
                while ((s=bufferedReader.readLine())!=null){
                    if(flag.equals(66)) {
                        System.out.println(Thread.currentThread().getState()); // è¯»å–æ–‡ä»¶å±äºBIOé˜»å¡ï¼Œç³»ç»Ÿå±‚é¢çœ‹çº¿ç¨‹æ˜¯é˜»å¡çŠ¶æ€ï¼Œä½†æ˜¯JAVAå±‚é¢çº¿ç¨‹æ˜¯RUNNABLEçŠ¶æ€
                    }
                    flag++;
                }
            } catch (IOException e) {
                throw new RuntimeException(e);
            }
        });
        System.out.println(t1.getState()); // è·å–çº¿ç¨‹çŠ¶æ€ï¼ŒNEWï¼šåˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•
        t1.start();
        Thread.sleep(1000); // ç­‰åˆ°å­çº¿ç¨‹æ‰§è¡Œç»“æŸ
        System.out.println(t1.getState()); // å­çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œçº¿ç¨‹çŠ¶æ€æ˜¯ TERMINATED
        System.out.println("ä¸»çº¿ç¨‹ç»“æŸ");
    }
}
```

- WAITINGã€TIMED_WAITINGã€BLOCKED

```java
public class TestThreadState2 {
    /*ä»Java 8å¼€å§‹ï¼Œå³ä¾¿æ²¡æœ‰æ˜ç¡®å£°æ˜ä¸ºfinalï¼Œåªè¦åœ¨lambdaè¡¨è¾¾å¼å¤–éƒ¨å®šä¹‰çš„å˜é‡åœ¨å…¶èµ‹å€¼åä¸å†æœ‰å…¶ä»–èµ‹å€¼æ“ä½œï¼Œ
    é‚£ä¹ˆè¿™ä¸ªå˜é‡ä¹Ÿè¢«è§†ä¸ºâ€œæœ‰æ•ˆåœ°finalâ€ï¼Œå¯ä»¥åœ¨lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ç¼–è¯‘å™¨ä¼šæ£€æŸ¥å˜é‡æ˜¯å¦åœ¨èµ‹å€¼åä¸å†æ”¹å˜ï¼Œ
    å¦‚æœæ˜¯ï¼Œåˆ™å…è®¸åœ¨lambdaä¸­ä½¿ç”¨ã€‚*/
    public static void main(String[] args) throws InterruptedException {
        System.out.println("ä¸»çº¿ç¨‹å¼€å§‹");
        String lockedObject = "Give Me";
        Thread t1 = new Thread(()->{
            try {
                Thread.sleep(3000);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        });
        Thread t2 = new Thread(()->{
            try {
                t1.join(); // t2 çº¿ç¨‹ç­‰å¾… t1 çº¿ç¨‹ç»“æŸï¼Œå±äºæ— é™æ—¶ç­‰å¾…çŠ¶æ€
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
        });
        Thread t3 = new Thread(()->{
            synchronized (lockedObject){
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
            }
        });
        Thread t4 = new Thread(()->{
            synchronized (lockedObject){
                try {
                    Thread.sleep(1000);
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
            }
        });

        t1.start();
        t2.start();
        t3.start();
        t4.start();
        System.out.println("t3: " + t3.getState()); // è·å–åˆ°é”æ—¶ï¼Œå¤„äº RUNNABLE çŠ¶æ€ï¼Œå¦åˆ™å±äº BLOCKED é˜»å¡æ€
        System.out.println("t4: " + t4.getState()); // è·å–åˆ°é”æ—¶ï¼Œå¤„äº RUNNABLE çŠ¶æ€ï¼Œå¦åˆ™å±äº BLOCKED é˜»å¡æ€
        Thread.sleep(1000);
        System.out.println("t1: " + t1.getState()); // å­çº¿ç¨‹ç¡çœ ï¼Œå¤„äº TIMED_WAITING çŠ¶æ€ï¼Œé™æ—¶ç­‰å¾…çŠ¶æ€
        System.out.println("t2: " + t2.getState()); // t2 çº¿ç¨‹ç­‰å¾… t1 çº¿ç¨‹ç»“æŸï¼Œå±äºæ— é™æ—¶ç­‰å¾…çŠ¶æ€ WAITING
        System.out.println("ä¸»çº¿ç¨‹ç»“æŸ");
    }
}
```

## å››ã€çº¿ç¨‹å¸¸ç”¨API

### 1. start & run

- start(): å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹ä¸­è¿è¡Œ run() æ–¹æ³•ä¸­çš„ä»£ç ã€‚start() æ–¹æ³•è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œ run() ä¸­ä»£ç ï¼Œæœ‰å¯èƒ½CPUçš„æ—¶é—´ç‰‡è¿˜æ²¡æœ‰åˆ†é…ç»™å®ƒã€‚æ¯ä¸ªçº¿ç¨‹çš„startæ–¹æ³•ï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚å¦åˆ™ä¼šå‡ºç° IlegalThreadStateException å¼‚å¸¸;
- run(): æ–°çº¿ç¨‹å¯åŠ¨åè‡ªåŠ¨è°ƒç”¨çš„æ–¹æ³•ã€‚å¦‚æœåœ¨æ„é€  Thread å¯¹è±¡æ—¶ï¼Œä¼ é€’äº† Runnable å‚æ•°ï¼Œçº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨ Runnable ä¸­çš„ run() æ–¹æ³•, å¦åˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»ºThreadå­ç±»å¯¹è±¡æ¥é‡å†™ run() æ–¹æ³•;

> åŒºåˆ«: ç›´æ¥è°ƒç”¨ run() æ–¹æ³•ï¼Œå…¶å®æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œ run()ï¼Œå¹¶æ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œä¹Ÿæ²¡æœ‰å¼€è¾Ÿæ–°çš„æ ˆå¸§; ä½¿ç”¨ start() æ–¹æ³•ï¼Œå¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œå¼€è¾Ÿäº†æ–°çš„æ ˆå¸§ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹å»è°ƒç”¨ run() ä¸­çš„ä»£ç ã€‚

### 2. çº¿ç¨‹ä¼˜å…ˆçº§

çº¿ç¨‹ä¼˜å…ˆçº§é«˜çš„ä¼šæç¤ºä»»åŠ¡è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼šæœ€å¤§å€¼10ï¼Œæœ€å°å€¼1ï¼Œé»˜è®¤5ï¼›

- setPriority(): è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼›
- getPriority(): è·å–çº¿ç¨‹ä¼˜å…ˆçº§ï¼›

```java
public class TestThreadAPI {
    public static void main(String[] args) {
        Thread t1 = new Thread(()->{});
        t1.start(); // start() åªèƒ½è°ƒç”¨ä¸€æ¬¡
//        t1.start(); // start() åªèƒ½è°ƒç”¨ä¸€æ¬¡
        // çº¿ç¨‹ä¼˜å…ˆçº§
        Thread t2 = new Thread(()->{
            int i=0;
            while(true){
                System.out.println(Thread.currentThread().getName() + ":" + i++);
            }
        }, "çº¿ç¨‹1");
        Thread t3 = new Thread(()->{
            int i=0;
            while(true){
                System.out.println("\t\t" + Thread.currentThread().getName() + ":" + i++);
            }
        }, "çº¿ç¨‹2");
        t2.setPriority(Thread.MIN_PRIORITY);
        t3.setPriority(Thread.MAX_PRIORITY);
        System.out.println(t1.getPriority());
        System.out.println(t2.getPriority());
        System.out.println(t3.getPriority());
        t2.start();
        t3.start();
    }
}
```

### 3. sleep & yield

- sleep(): è®©å‡ºCPUï¼Œé™ä½CPUä½¿ç”¨é¢‘ç‡
  - è°ƒç”¨ sleep è®©çº¿ç¨‹ä¼‘çœ ï¼Œä¼šå°†å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€è¿›å…¥åˆ° TIMED_WAITING çŠ¶æ€;
  - å…¶ä»–çº¿ç¨‹å¯ä»¥æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹(interrupt), åœ¨ä¼‘çœ çš„çº¿ç¨‹ï¼Œè¢«æ‰“æ–­æ—¶ï¼Œä¼šæŠ›å‡º InterruptedException;
  - å½“çº¿ç¨‹ä¼‘çœ è¢«æ‰“æ–­ï¼Œçº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œï¼Œéœ€è¦è·å–CPUæ—¶é—´ç‰‡ï¼›
  - å»ºè®®ä½¿ç”¨ TimeUnit ä»£æ›¿ Thread.sleep æ–¹æ³•ï¼Œå¯è¯»æ€§æ›´å¼ºï¼›`TimeUnit.SECONDS.sleep(2);`

```java
public class TestThreadAPI2 {
    public static void main(String[] args) throws InterruptedException {
        System.out.println("ä¸»çº¿ç¨‹å¼€å§‹");
        Thread t1 = new Thread(()->{
            try {
                TimeUnit.SECONDS.sleep(3);
//                Thread.sleep(2000);
            } catch (InterruptedException e) {
                System.out.println("å­çº¿ç¨‹è¢«å”¤é†’");
                System.out.println("4: " + Thread.currentThread().getState()); // çº¿ç¨‹ä¼‘çœ è¢«å”¤é†’å. è·³è¿‡ä¼‘çœ ï¼Œè¿›å…¥RUNNABLEçŠ¶æ€
                throw new RuntimeException(e);
            }
            System.out.println("å­çº¿ç¨‹ç»“æŸ");
        });
        System.out.println("1: " + t1.getState()); // NEW
        t1.start();
        TimeUnit.SECONDS.sleep(1);
        System.out.println("2: " + t1.getState()); // TIMED_WAITING
        t1.interrupt();
        t1.join();
        System.out.println("3: " + t1.getState()); // TERMINATED
        System.out.println("ä¸»çº¿ç¨‹ç»“æŸ");
    }
}
```

- yield(): æœ¬åœ°æ–¹æ³•
  - è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€ï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œè®©å‡ºCPUï¼Œè°ƒåº¦å™¨æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ã€‚å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ï¼›
  - è¡¨ç¤ºå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡ºCPUï¼Œä½†å…·ä½“æ˜¯å¦è®©å‡ºï¼Œè¦ä¾æ®OSçš„ä»»åŠ¡è°ƒåº¦å™¨,å¯èƒ½å‡ºç°è®©å‡ºCPUåï¼Œåˆç«‹å³è·å¾—CPUï¼›
  - Thread.yield();

> åŒºåˆ«ï¼š
>
> - sleep æ–¹æ³•ä½¿ç”¨å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œæ‰§è¡Œsleepçš„çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œè‚¯å®šä¸ä¼šè¢«æ‰§è¡Œï¼›
> - yield æ–¹æ³•ï¼Œè®©å½“å‰çº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€é‡æ–°å›åˆ°å¯æ‰§è¡ŒçŠ¶æ€ï¼Œæœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å¯æ‰§è¡ŒçŠ¶æ€åï¼Œé©¬ä¸Šåˆè¢«æ‰§ï¼›
> - sleep æ–¹æ³•ï¼Œä½¿å½“å‰çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´ï¼Œè¿›å…¥ä¸å¯è¿è¡ŒçŠ¶æ€ï¼Œè¿™æ®µæ—¶é—´é•¿çŸ­æ˜¯ç”±ç¨‹åºå†³å®šçš„ï¼›
> - yield æ–¹æ³•ï¼Œè®©å‡ºCPUå æœ‰æƒï¼Œæ—¶é—´æ˜¯ä¸å¯è®¾å®šçš„ã€‚

```java
public class TestYield {
    public static void main(String[] args) {
        Thread t1 = new Thread(()->{
            int i=0;
            while (true){
                Thread.yield();
                System.out.println("\t\t" + Thread.currentThread().getName() + ":" + i++);
            }
        }, "çº¿ç¨‹1");
        Thread t2 = new Thread(()->{
            int i=0;
            while (true){
                System.out.println(Thread.currentThread().getName() + ":" + i++);
            }
        }, "çº¿ç¨‹2");
        t1.start();
        t2.start();
    }
}
```

### 4. join

- join(): ç­‰å¾…åŠ å…¥çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œæ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›
- join(t): å½“å‰çº¿ç¨‹æœ€å¤šç­‰å¾…åŠ å…¥çš„çº¿ç¨‹tæ—¶é—´ï¼Œè¦ä¹ˆjoinçš„çº¿ç¨‹ç»ˆç»“ï¼Œè¦ä¹ˆè¶…æ—¶ï¼Œéƒ½è¦ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›

```java
public class TestJoin {
    private static Integer x = 0;
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(()->{
            try {
                TimeUnit.SECONDS.sleep(2);
            } catch (InterruptedException e) {
                throw new RuntimeException(e);
            }
            x = 100;
        });
        t1.start();
//        t1.join();
        t1.join(2000);
        System.out.println(x);
    }
}
```

### 5. interruput â¤ï¸

- 1. æ‰“æ–­ sleepã€waitã€joinæ–¹æ³•ï¼Œå¤„ç†é˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼›ä¼šæ¸…ç©ºæ‰“æ–­çš„çŠ¶æ€ï¼Œæ‰“æ–­çŠ¶æ€æ ‡è®°ä¸º falseï¼› ğŸ‘
- 2. æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ï¼›ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ï¼Œæ‰“æ–­çŠ¶æ€æ ‡è®°ä¸º trueï¼› ğŸ‘
- isInterrupted(): è·å–æ‰“æ–­æ ‡è®°ï¼›

```java
public class TestInterruput {
    public static void main(String[] args) throws InterruptedException {
        // sleep wait join è¢«æ‰“æ–­ï¼Œæ‰“æ–­æ ‡è®°ä¼šè¢«æ¸…é™¤
        Thread t1 = new Thread(()->{
            try {
                TimeUnit.SECONDS.sleep(2);
            } catch (InterruptedException e) {
                System.out.println(Thread.currentThread().getName() + ": ä¼‘çœ è¢«æ‰“æ–­");
                System.out.println(Thread.currentThread().isInterrupted()); // è·å–æ‰“æ–­æ ‡è®° fasle
                throw new RuntimeException(e);
            }
        }, "t1");
        t1.start();
        t1.interrupt();
        // æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹ï¼Œæ‰“æ–­æ ‡è®°ä¸ä¼šè¢«æ¸…é™¤
        Thread t2 = new Thread(()->{
            while (true){
                if(Thread.currentThread().isInterrupted()){ // åˆ¤æ–­æ‰“æ–­æ ‡è®° true
                    System.out.println(Thread.currentThread().getName() + ": æ­£å¸¸è¿è¡Œè¢«æ‰“æ–­");
                    System.out.println(Thread.currentThread().isInterrupted());
                    break;
                }
            }
        }, "t2");
        t2.start();
        TimeUnit.SECONDS.sleep(1);
        t2.interrupt();
    }
}
```

### 6. å®ˆæŠ¤çº¿ç¨‹ ğŸ‘

javaç¨‹åºä¸­ï¼Œæœ‰ä¸¤ç§çº¿ç¨‹ï¼š


- ä¸€ç§æ˜¯ç”¨æˆ·çº¿ç¨‹ User Threadï¼›
- ä¸€ç§æ˜¯å®ˆæŠ¤çº¿ç¨‹ Daemon Thread æŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶ï¼Œåœ¨åå°æä¾›çš„ä¸€ç§é€šç”¨æœåŠ¡çº¿ç¨‹ï¼›
- å½“æ‰€æœ‰çš„ç”¨æˆ·çº¿ç¨‹ç»“æŸæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±ç»ˆæ­¢äº†ï¼ŒåŒæ—¶ä¼šæ€æ­»è¿›ç¨‹ä¸­çš„æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼›

setDaemon(true): è®¾ç½®å®ˆæŠ¤çº¿ç¨‹ï¼Œå¦‚æœå‚æ•°ä¸ºtrueï¼Œåˆ™å°†å½“å‰çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå¦åˆ™æ˜¯ç”¨æˆ·çº¿ç¨‹ï¼›

> åº”ç”¨åœºæ™¯ï¼šJava åƒåœ¾å›æ”¶ï¼›

```java
public class TestDaemon {
    public static void main(String[] args) {
        // åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹
        Thread daemonThread = new Thread(new Runnable() {
            @Override
            public void run() {
                while (true) {
                    try {
                        System.out.println("å®ˆæŠ¤çº¿ç¨‹æ­£åœ¨è¿è¡Œ...");
                        // è®©çº¿ç¨‹ç¡çœ 1ç§’ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œä»»åŠ¡
                        Thread.sleep(1000);
                    } catch (InterruptedException e) {
                        Thread.currentThread().interrupt(); // ä¿æŒä¸­æ–­çŠ¶æ€
                        System.out.println("å®ˆæŠ¤çº¿ç¨‹è¢«ä¸­æ–­");
                        return; // ç»“æŸçº¿ç¨‹
                    }
                }
            }
        }, "DaemonThread");

        // è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹
        daemonThread.setDaemon(true);

        // å¯åŠ¨å®ˆæŠ¤çº¿ç¨‹
        daemonThread.start();

        // ä¸»çº¿ç¨‹ä»»åŠ¡
        for (int i = 0; i < 5; i++) {
            try {
                System.out.println("ä¸»çº¿ç¨‹æ­£åœ¨è¿è¡Œ...");
                Thread.sleep(500);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                e.printStackTrace();
            }
        }

        System.out.println("ä¸»çº¿ç¨‹ç»“æŸï¼Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°†éšä¹‹ç»“æŸã€‚");
    }
}
```
